import { Args } from '@oclif/core';
import chalk from 'chalk';
import ora from 'ora';
import { update } from '../../../actions/functions/env/update.js';
import { DeployedBlueprintCommand } from '../../../baseCommands.js';
import { findFunctionByName } from '../../../utils/find-function.js';
export default class EnvAddCommand extends DeployedBlueprintCommand {
    static args = {
        name: Args.string({ description: 'The name of the Sanity Function', required: true }),
        key: Args.string({ description: 'The name of the environment variable', required: true }),
        value: Args.string({ description: 'The value of the environment variable', required: true }),
    };
    static description = 'Add or set the value of an environment variable for a Sanity function';
    static examples = [
        '<%= config.bin %> <%= command.id %> MyFunction API_URL https://api.example.com/',
    ];
    async run() {
        const args = this.args;
        const spinner = ora(`Updating "${args.key}" environment variable in "${args.name}"`).start();
        const { externalId } = findFunctionByName(this.deployedStack, args.name);
        const result = await update(externalId, args.key, args.value, this.auth);
        if (result.ok) {
            spinner.succeed(`Update of ${args.key} succeeded`);
        }
        else {
            spinner.fail(`${chalk.red('Failed')} to update ${args.key}`);
            this.log(`Error: ${result.error || 'Unknown error'}`);
        }
    }
}
